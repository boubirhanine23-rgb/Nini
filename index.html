<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hanin & Bibou Scene</title>
    <style>
        body { margin: 0; overflow: hidden; }
        canvas { display: block; }

        /* Dialogue bubble */
        #dialogue {
            position: absolute;
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 15px 25px;
            border-radius: 20px;
            font-family: 'Arial', sans-serif;
            font-size: 18px;
            max-width: 500px;
            text-align: center;
            cursor: pointer;
            user-select: none;
        }
    </style>
</head>
<body>
    <div id="dialogue">Click to start the conversation...</div>

    <!-- Include Three.js -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
    <!-- Include GLTFLoader -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.158.0/examples/js/loaders/GLTFLoader.js"></script>
    <!-- Include OrbitControls for camera movement (optional) -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.158.0/examples/js/controls/OrbitControls.js"></script>

    <script>
        let scene, camera, renderer, clock;
        let hanin, bibou, boat, fishGroup;
        let dialogue = document.getElementById('dialogue');
        let dialogueIndex = 0;

        // Dialogue lines
        const dialogues = [
            "Hanin: The night is so beautiful tonight...",
            "Bibou: Yeah, the moon looks amazing over the sea.",
            "Hanin: I feel like dancing!",
            "Bibou: You and me, always.",
            "Hanin: Will you join me?",
            "Bibou: Yes!"
        ];

        init();
        animate();

        function init() {
            // Scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x0b0c1f); // Night sky

            // Camera
            camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 1000);
            camera.position.set(0, 2, 6);

            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            // Controls (optional)
            const controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.target.set(0,1,0);
            controls.update();

            // Lights
            const ambient = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambient);
            const moonLight = new THREE.DirectionalLight(0xffffff, 1);
            moonLight.position.set(5, 10, 5);
            scene.add(moonLight);

            // Water (simple plane for now)
            const waterGeometry = new THREE.PlaneGeometry(50, 50);
            const waterMaterial = new THREE.MeshPhongMaterial({ color: 0x1e3f6e, transparent: true, opacity: 0.7 });
            const water = new THREE.Mesh(waterGeometry, waterMaterial);
            water.rotation.x = -Math.PI/2;
            water.position.y = 0;
            scene.add(water);

            // Clock
            clock = new THREE.Clock();

            // Load models (placeholders)
            const loader = new THREE.GLTFLoader();
            // Example: Replace these with your actual 3D models
            loader.load('models/hanin.glb', gltf => {
                hanin = gltf.scene;
                hanin.position.set(-1, 0, 0);
                scene.add(hanin);
            });
            loader.load('models/bibou.glb', gltf => {
                bibou = gltf.scene;
                bibou.position.set(1, 0, 0);
                scene.add(bibou);
            });
            loader.load('models/boat.glb', gltf => {
                boat = gltf.scene;
                boat.position.set(0, 0, -2);
                boat.visible = false; // appear later
                scene.add(boat);
            });

            // Fish group
            fishGroup = new THREE.Group();
            scene.add(fishGroup);

            // Audio
            const listener = new THREE.AudioListener();
            camera.add(listener);

            // Background music and waves
            const bgSound = new THREE.Audio(listener);
            const audioLoader = new THREE.AudioLoader();
            audioLoader.load('audio/beach_waves.mp3', function(buffer){
                bgSound.setBuffer(buffer);
                bgSound.setLoop(true);
                bgSound.setVolume(0.5);
                bgSound.play();
            });

            // Dialogue click
            dialogue.addEventListener('click', () => {
                if(dialogueIndex < dialogues.length){
                    dialogue.innerText = dialogues[dialogueIndex];
                    // Placeholder: animate mouth
                    if(hanin) hanin.rotation.y = Math.sin(dialogueIndex)*0.1; // simple placeholder
                    dialogueIndex++;

                    // If last line
                    if(dialogueIndex === dialogues.length){
                        // Show boat, fireworks, fish after a short delay
                        setTimeout(() => {
                            if(boat) boat.visible = true;
                            launchFireworks();
                            spawnFish();
                        }, 1000);
                    }
                }
            });

            window.addEventListener('resize', onWindowResize, false);
        }

        function onWindowResize(){
            camera.aspect = window.innerWidth/window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate(){
            requestAnimationFrame(animate);
            const delta = clock.getDelta();

            // Simple fish animation
            if(fishGroup){
                fishGroup.children.forEach((fish, i)=>{
                    fish.position.y += Math.sin(clock.getElapsedTime()*2 + i) * 0.01;
                    fish.rotation.y += 0.01;
                });
            }

            renderer.render(scene, camera);
        }

        // Placeholder fireworks
        function launchFireworks(){
            const geometry = new THREE.SphereGeometry(0.05, 8, 8);
            const material = new THREE.MeshBasicMaterial({ color: 0xff0000 });
            for(let i=0;i<20;i++){
                const firework = new THREE.Mesh(geometry, material);
                firework.position.set(Math.random()*4-2, 1+Math.random()*2, -2);
                scene.add(firework);
                setTimeout(()=>{ scene.remove(firework); }, 2000);
            }
        }

        // Placeholder fish spawn
        function spawnFish(){
            const loader = new THREE.GLTFLoader();
            for(let i=0;i<5;i++){
                loader.load('models/fish.glb', gltf => {
                    const fish = gltf.scene;
                    fish.position.set(Math.random()*4-2, Math.random()*1+0.5, -1);
                    fishGroup.add(fish);
                });
            }
        }
    </script>
</body>
</html>
